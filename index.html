<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>COPILOTO PRO ‚Äî Dados Oficiais</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg:#f8fafc; --panel:#ffffff; --text:#0f172a; --muted:#64748b; --border:#e2e8f0;
    --primary:#2563eb; --accent:#f59e0b; --success:#16a34a; --radius:12px;
  }

  *{box-sizing:border-box; font-family: 'Inter', system-ui, sans-serif;}
  body{ margin:0; background: var(--bg); color: var(--text); }

  .eco-header { background: #0f172a; color: #fff; padding: 10px 20px; display: flex; justify-content: space-between; align-items: center; font-size: 13px; }
  .eco-stats { display: flex; gap: 20px; }
  .eco-item span { color: var(--accent); font-weight: 800; margin-left: 5px; }
  #live-clock { font-family: monospace; font-size: 15px; color: #fff; border-left: 1px solid #334155; padding-left: 20px; }

  header{ position:sticky; top:0; z-index:50; background:rgba(255,255,255,.9); backdrop-filter: blur(10px); border-bottom:1px solid var(--border); padding:10px 20px; }
  .topbar{ max-width:1400px; margin:0 auto; display:flex; justify-content:space-between; align-items:center; }
  
  main{ max-width:1400px; margin:20px auto; padding:0 20px; display:grid; grid-template-columns: 350px 1fr 400px; gap:20px; }

  .card{ background:white; border-radius:var(--radius); border:1px solid var(--border); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); overflow:hidden; margin-bottom:15px;}
  .card-head{ padding:12px 15px; border-bottom:1px solid var(--border); background:#f8fafc; font-weight:800; font-size:11px; color:var(--muted); text-transform:uppercase; letter-spacing: 1px; }
  .card-body{ padding:15px; }

  .info-block { background: #f1f5f9; border-radius: 8px; padding: 12px; margin-top: 10px; }
  .info-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #e2e8f0; font-size: 13px; }
  .info-item:last-child { border: none; }

  .proc-calc { background: #fff7ed; border: 1px dashed #fdba74; padding: 15px; border-radius: 8px; margin-top: 15px; }
  .loss-value { color: #dc2626; font-size: 20px; font-weight: 800; }

  button, .btn-link{ padding:10px 20px; border-radius:8px; border:none; cursor:pointer; font-weight:700; transition: 0.2s; text-decoration: none; display: inline-block; text-align: center; }
  .btn-primary{ background: var(--primary); color:white; }
  .btn-success{ background: var(--success); color:white; width:100%; margin-top:15px; font-size:14px; }
  .btn-danger{ background: #fee2e2; color: #b91c1c; padding: 5px 10px; font-size: 11px; }
  .btn-export{ background: #000; color: #fff; width:100%; margin-bottom:20px; padding:18px; border: 2px solid var(--primary); font-size:16px; }

  input, textarea, select { width:100%; padding:10px; margin: 5px 0 12px 0; border:1px solid var(--border); border-radius:8px; }
  label { font-size: 11px; font-weight: 700; color: var(--muted); text-transform: uppercase; }

  #adminDrawer{ position:fixed; inset:0; display:none; z-index:100; }
  #adminDrawer.show{ display:flex; }
  .drawer-content{ width:min(850px, 95%); background:white; margin-left:auto; height:100%; box-shadow:-20px 0 50px rgba(0,0,0,0.2); display:flex; flex-direction:column; }
  .drawer-tabs { display: flex; background: #f1f5f9; padding: 10px 20px 0 20px; gap: 5px; }
  .tab-btn { padding: 10px 20px; background: #e2e8f0; border-radius: 8px 8px 0 0; color: var(--muted); border: none; cursor: pointer; }
  .tab-btn.active { background: white; color: var(--primary); font-weight: 800; }
  .drawer-body{ flex:1; overflow-y:auto; padding:30px; }
  .data-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; font-size: 13px; }

  @media (max-width: 1100px){ main{ grid-template-columns: 1fr; } }
</style>
</head>
<body onload="startTime(); updateEcoRates();">

<div class="eco-header">
  <div class="eco-stats">
    <div class="eco-item">SELIC: <span id="val-selic">Carregando...</span></div>
    <div class="eco-item">IPCA (12m): <span id="val-ipca">Carregando...</span></div>
    <div class="eco-item">IGP-M: <span id="val-igpm">Carregando...</span></div>
  </div>
  <div id="live-clock">00:00:00</div>
</div>

<header>
  <div class="topbar">
    <div><strong>COPILOTO PRO</strong> <span id="userBadge" style="font-size:10px; background:#eee; padding:2px 6px; border-radius:4px;"></span></div>
    <div id="userTools" style="display:none; gap:10px;">
      <button class="btn-outline" id="btnAdmin" onclick="openAdmin()">‚öôÔ∏è Painel de Edi√ß√£o</button>
      <button onclick="location.reload()">Sair</button>
    </div>
  </div>
</header>

<div id="loginArea" style="position:fixed; inset:0; background:var(--bg); z-index:200; display:flex; align-items:center; justify-content:center;">
  <div class="card" style="width:350px; padding:30px;">
    <h2>Acesso Portal</h2>
    <input id="lUser" type="text" placeholder="Usu√°rio" value="edson">
    <input id="lPass" type="password" placeholder="Senha" value="2026">
    <button class="btn-primary" onclick="initApp()" style="width:100%">Entrar</button>
  </div>
</div>

<main id="appMain" style="opacity:0.1; pointer-events:none;">
  <aside>
    <div class="card">
      <div class="card-head">Ficha T√©cnica do Im√≥vel</div>
      <div class="card-body">
        <h2 id="view-name" style="color:var(--primary); margin:0 0 10px 0;">Aguardando...</h2>
        <div id="view-details" class="info-block">
          <p style="font-size:12px; color:var(--muted)">Os dados aqui s√£o os que voc√™ cadastrou.</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-head">Procrastina√ß√£o (12 meses)</div>
      <div class="card-body proc-calc">
        <div class="loss-value" id="view-loss">R$ 0,00</div>
      </div>
    </div>

    <a href="https://lucianabogo333-spec.github.io/formalizacao-proposta/" target="_blank" class="btn-link btn-success">
      üìù FORMALIZA√á√ÉO DE PROPOSTA
    </a>
  </aside>

  <section>
    <div class="card">
      <div class="card-head">Escuta Estrat√©gica</div>
      <div class="card-body">
        <textarea id="mainInput" placeholder="O que o cliente est√° dizendo?" style="min-height:350px;"></textarea>
        <button class="btn-primary" id="micBtn" onclick="toggleMic()" style="width:100%; margin-top:10px; height:50px;">üéôÔ∏è Capturar Voz</button>
      </div>
    </div>
  </section>

  <aside>
    <div class="card"><div class="card-head">Quebra Sugerida</div><div class="card-body">
      <div id="res-box" style="font-size:15px; line-height:1.5;">Aguardando obje√ß√µes...</div>
    </div></div>
    <div class="card"><div class="card-head">Proje√ß√£o Patrimonial</div><div class="card-body"><canvas id="mainChart"></canvas></div></div>
  </aside>
</main>

<div id="adminDrawer">
  <div style="flex:1; background:rgba(0,0,0,0.6)" onclick="closeAdmin()"></div>
  <div class="drawer-content">
    <div style="padding:20px 20px 0 20px">
        <h2>Gest√£o de Dados</h2>
        <button class="btn-export" onclick="copyFullCode()">üöÄ COPIAR C√ìDIGO ATUALIZADO (GITHUB)</button>
    </div>
    
    <div class="drawer-tabs">
        <button class="tab-btn active" onclick="showTab('tab-users', this)">Usu√°rios</button>
        <button class="tab-btn" onclick="showTab('tab-products', this)">Produtos</button>
        <button class="tab-btn" onclick="showTab('tab-objections', this)">Obje√ß√µes</button>
    </div>

    <div class="drawer-body">
        <div id="tab-users" class="tab-content">
            <label>Login</label><input id="fUserLogin">
            <label>Senha</label><input id="fUserPass">
            <label>Perfil</label><select id="fUserRole"><option value="admin">Admin</option><option value="vendedor">Vendedor</option></select>
            <button class="btn-primary" onclick="saveData('users')">Adicionar</button>
            <div id="list-users" style="margin-top:20px"></div>
        </div>

        <div id="tab-products" class="tab-content" style="display:none">
            <label>Nome do Produto</label><input id="fProdName">
            <label>Chaves p/ Busca (v√≠rgula)</label><input id="fProdKeys">
            <label>Valor de Venda (R$)</label><input id="fProdVal" type="number">
            <label>Estimativa Valoriza√ß√£o Anual (%)</label><input id="fProdRate" type="number">
            <label>Dados Reais (uma info por linha)</label><textarea id="fProdInfo" style="min-height:100px"></textarea>
            <button class="btn-primary" onclick="saveData('products')">Salvar Produto</button>
            <div id="list-products" style="margin-top:20px"></div>
        </div>

        <div id="tab-objections" class="tab-content" style="display:none">
            <label>Obje√ß√£o Chave</label><input id="fObjKeys">
            <label>Argumento Leve</label><textarea id="fObjA"></textarea>
            <label>Argumento Forte</label><textarea id="fObjB"></textarea>
            <label>Fechamento</label><textarea id="fObjC"></textarea>
            <button class="btn-primary" onclick="saveData('objections')">Salvar Obje√ß√£o</button>
            <div id="list-objections" style="margin-top:20px"></div>
        </div>
    </div>
    <button class="btn-outline" style="margin:20px" onclick="closeAdmin()">Fechar</button>
  </div>
</div>

<script id="databaseScript">
  let base = {
    users: [{login:"edson", pass:"2026", role:"admin"}],
    products: [],
    objections: []
  };
</script>

<script>
let chart;

// BUSCA DE TAXAS REAIS (API BANCO CENTRAL)
async function updateEcoRates() {
    try {
        const fetchRate = async (id) => {
            const r = await fetch(`https://api.bcb.gov.br/dados/serie/bcdata.sgs.${id}/dados/ultimos/1?formato=json`);
            const d = await r.json();
            return d[0].valor;
        };
        document.getElementById('val-selic').innerText = await fetchRate(11) + '%'; // Selic
        document.getElementById('val-ipca').innerText = await fetchRate(433) + '%'; // IPCA
        document.getElementById('val-igpm').innerText = await fetchRate(189) + '%'; // IGP-M
    } catch (e) {
        console.log("Erro ao buscar taxas, usando padr√£o.");
        document.getElementById('val-selic').innerText = '11.25%';
    }
}

function startTime() {
  document.getElementById('live-clock').innerHTML = new Date().toLocaleTimeString('pt-BR');
  setTimeout(startTime, 1000);
}

function initApp() {
  const user = base.users.find(x => x.login === document.getElementById("lUser").value && x.pass === document.getElementById("lPass").value);
  if(user) {
    document.getElementById("loginArea").style.display = "none";
    document.getElementById("appMain").style.opacity = "1";
    document.getElementById("appMain").style.pointerEvents = "all";
    document.getElementById("userTools").style.display = "flex";
    document.getElementById("userBadge").innerText = user.role.toUpperCase();
    if(user.role !== 'admin') document.getElementById("btnAdmin").style.display = 'none';
    initChart();
    renderLists();
  }
}

document.getElementById("mainInput").addEventListener("input", function() {
  const text = this.value.toLowerCase();
  const p = base.products.find(item => item.keys.some(k => text.includes(k.trim().toLowerCase())));
  if(p) {
    document.getElementById("view-name").innerText = p.name;
    let html = p.info.filter(i => i.trim() !== "").map(i => `<div class="info-item"><span>${i}</span></div>`).join("");
    html += `<div class="info-item"><strong>Valor Hoje:</strong> <span>R$ ${p.baseVal.toLocaleString()}</span></div>`;
    html += `<div class="info-item"><strong>Valoriza√ß√£o:</strong> <span>${p.rate}% a.a.</span></div>`;
    document.getElementById("view-details").innerHTML = html;
    const loss = p.baseVal * (p.rate / 100);
    document.getElementById("view-loss").innerText = `R$ ${loss.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
    updateChart(p.baseVal, p.rate);
  }
  const o = base.objections.find(item => item.keys.some(k => text.includes(k.trim().toLowerCase())));
  if(o) {
    document.getElementById("res-box").innerHTML = `<b>Leve:</b> ${o.a}<br><br><b>Forte:</b> ${o.b}<br><br><b>Fechamento:</b> ${o.c}`;
  }
});

function saveData(type) {
    if(type === 'users') {
        base.users.push({ login: document.getElementById("fUserLogin").value, pass: document.getElementById("fUserPass").value, role: document.getElementById("fUserRole").value });
    } else if(type === 'products') {
        base.products.push({ 
            name: document.getElementById("fProdName").value.toUpperCase(),
            keys: document.getElementById("fProdKeys").value.split(",").map(k => k.trim()),
            baseVal: Number(document.getElementById("fProdVal").value),
            rate: Number(document.getElementById("fProdRate").value),
            info: document.getElementById("fProdInfo").value.split("\n")
        });
    } else if(type === 'objections') {
        base.objections.push({
            keys: document.getElementById("fObjKeys").value.split(",").map(k => k.trim()),
            a: document.getElementById("fObjA").value, b: document.getElementById("fObjB").value, c: document.getElementById("fObjC").value
        });
    }
    renderLists();
}

function removeData(type, index) { base[type].splice(index, 1); renderLists(); }

function renderLists() {
    document.getElementById("list-users").innerHTML = base.users.map((u, i) => `<div class="data-row">${u.login} <button class="btn-danger" onclick="removeData('users', ${i})">X</button></div>`).join("");
    document.getElementById("list-products").innerHTML = base.products.map((p, i) => `<div class="data-row">${p.name} <button class="btn-danger" onclick="removeData('products', ${i})">X</button></div>`).join("");
    document.getElementById("list-objections").innerHTML = base.objections.map((o, i) => `<div class="data-row">${o.keys[0]} <button class="btn-danger" onclick="removeData('objections', ${i})">X</button></div>`).join("");
}

function copyFullCode() {
  const scriptDb = document.getElementById("databaseScript");
  scriptDb.innerHTML = `\n  let base = ${JSON.stringify(base, null, 2)};\n`;
  navigator.clipboard.writeText("<!DOCTYPE html>\n" + document.documentElement.outerHTML);
  alert("C√ìDIGO OFICIAL COPIADO!");
}

function initChart() {
  const ctx = document.getElementById('mainChart').getContext('2d');
  chart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Hoje', 'Ano 1', 'Ano 2', 'Ano 3'],
      datasets: [{ label: 'Patrim√¥nio', data: [0,0,0,0], borderColor: '#2563eb', fill: true, backgroundColor: 'rgba(37,99,235,0.1)' }]
    }
  });
}

function updateChart(v, r) {
  let data = [v];
  for(let i=1; i<=3; i++) { v *= (1+(r/100)); data.push(Math.round(v)); }
  chart.data.datasets[0].data = data;
  chart.update();
}

function showTab(id, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(id).style.display = 'block';
    btn.classList.add('active');
}

function openAdmin() { document.getElementById("adminDrawer").classList.add("show"); }
function closeAdmin() { document.getElementById("adminDrawer").classList.remove("show"); }

let rec;
if(window.webkitSpeechRecognition) {
  rec = new webkitSpeechRecognition();
  rec.lang = 'pt-BR'; rec.continuous = true;
  rec.onresult = (e) => {
    document.getElementById("mainInput").value += " " + e.results[e.results.length-1][0].transcript;
    document.getElementById("mainInput").dispatchEvent(new Event('input'));
  };
}
function toggleMic() { 
  const b = document.getElementById("micBtn");
  if(b.innerText.includes("Capturar")) { rec.start(); b.innerText = "üõë PARAR"; b.style.background = "red"; }
  else { rec.stop(); b.innerText = "üéôÔ∏è Capturar Voz"; b.style.background = "var(--primary)"; }
}
</script>
</body>
</html>
