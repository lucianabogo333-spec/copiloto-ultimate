<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA ELITE SINOP V26</title>
    <style>
        :root { --bg: #05070a; --card: #111827; --primary: #2563eb; --good: #10b981; --bad: #ef4444; --gold: #f59e0b; --border: #374151; }
        * { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        header { background: #000; padding: 12px; border-bottom: 3px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .idx-tag { background: #1f2937; padding: 6px 10px; border-radius: 6px; font-size: 11px; border: 1px solid var(--gold); color: var(--gold); font-weight: bold; margin-right: 5px; white-space: nowrap; }
        main { flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 180px; }
        .busca-master { width: 100%; padding: 18px; border-radius: 12px; border: 3px solid var(--primary); background: #000; color: #fff; font-size: 18px; font-weight: bold; margin-bottom: 20px; box-shadow: 0 0 15px rgba(37, 99, 235, 0.3); }
        .card { background: var(--card); border-radius: 12px; padding: 16px; border: 2px solid var(--border); margin-bottom: 15px; position: relative; }
        .card-prod { border-left: 8px solid var(--primary); }
        .card-obj { border-left: 8px solid var(--gold); }
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 11px; text-align: center; color: #ffffff !important; transition: 0.2s; }
        .btn-blue { background: #2563eb; }
        .btn-green { background: #059669; }
        .btn-red { background: #dc2626; }
        .btn-gold { background: #f59e0b; color: #000 !important; }
        .label-f { display: block; font-size: 10px; color: var(--gold); font-weight: bold; margin-bottom: 4px; text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #4b5563; background: #000; color: #fff; margin-bottom: 10px; font-size: 14px; }
        .modal { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; padding: 20px; overflow-y: auto; }
        .footer { position: fixed; bottom: 0; width: 100%; background: #000; padding: 15px; border-top: 3px solid var(--primary); display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; z-index: 1000; }
        .calc-box { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--bad); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px; color: #fca5a5; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; background: rgba(0,0,0,0.4); padding: 10px; border-radius: 8px; }
        .admin-section { margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
    </style>
</head>
<body>

<div id="login" style="position:fixed; inset:0; background:#000; z-index:5000; display:flex; align-items:center; justify-content:center; padding:20px;">
    <div class="card" style="width:100%; max-width:350px; text-align:center;">
        <h2 style="color:var(--primary); margin-bottom:20px;">ELITE SINOP V26</h2>
        <input type="text" id="uIn" placeholder="Corretor">
        <input type="password" id="pIn" placeholder="Senha">
        <button onclick="login()" class="btn btn-blue" style="width:100%; padding:15px;">ACESSAR PAINEL</button>
    </div>
</div>

<header>
    <div style="display:flex; overflow-x:auto; padding-bottom: 5px;" id="indices">
        <div class="idx-tag">SINCRONIZANDO 12 MESES...</div>
    </div>
    <button onclick="abrir('adm')" class="btn btn-gold" id="btnAdm" style="display:none; margin-left:10px;">GESTOR ‚öôÔ∏è</button>
</header>

<main>
    <input type="text" id="busca" class="busca-master" placeholder="Busque: SPC, MAGGI, AGRO, CARO..." oninput="pesquisar(this.value)">
    <div id="feed"></div>
</main>

<div id="adm" class="modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2>‚öôÔ∏è CENTRAL DE CONTROLE</h2>
        <button onclick="fechar('adm')" class="btn btn-red">SAIR</button>
    </div>
    
    <div class="admin-section">
        <h3 style="color:var(--primary)">üì¶ PRODUTOS</h3>
        <input type="hidden" id="idxP" value="-1">
        <input type="text" id="p1" placeholder="Nome do Loteamento">
        <input type="text" id="p2" placeholder="Regi√£o">
        <input type="text" id="pk" placeholder="Gatilhos (spc, agro, caro)">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="number" id="p3" placeholder="Pre√ßo Total">
            <input type="number" id="p4" placeholder="√Årea M¬≤">
            <input type="text" id="p5" placeholder="Entrada">
            <input type="text" id="p6" placeholder="Parcela">
            <input type="text" id="p7" placeholder="Reajuste">
            <input type="text" id="p8" placeholder="Prazo">
        </div>
        <button onclick="salvarP()" class="btn btn-green" style="width:100%">SALVAR PRODUTO</button>
        <div id="listP" style="max-height:150px; overflow-y:auto; margin-top:10px;"></div>
    </div>

    <div class="admin-section">
        <h3 style="color:var(--gold)">üõ°Ô∏è OBJE√á√ïES</h3>
        <input type="hidden" id="idxO" value="-1">
        <input type="text" id="okey" placeholder="Gatilho (ex: spc, caro)">
        <input type="text" id="otit" placeholder="T√≠tulo da Obje√ß√£o">
        <textarea id="omsg" placeholder="Script de Contorno" rows="4"></textarea>
        <button onclick="salvarO()" class="btn btn-green" style="width:100%">SALVAR OBJE√á√ÉO</button>
        <div id="listO" style="max-height:150px; overflow-y:auto; margin-top:10px;"></div>
    </div>

    <div class="admin-section">
        <h3 style="color:var(--good)">üë• USU√ÅRIOS</h3>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="text" id="unome" placeholder="Login">
            <input type="text" id="usenha" placeholder="Senha">
        </div>
        <button onclick="salvarU()" class="btn btn-green" style="width:100%">ADICIONAR USU√ÅRIO</button>
        <div id="listU" style="max-height:100px; overflow-y:auto; margin-top:10px;"></div>
    </div>

    <button onclick="exportar()" class="btn btn-blue" style="width:100%; padding:20px; margin-top:10px;">üíæ AUTO-BUILD (GERAR NOVO HTML)</button>
</div>

<div id="propModal" class="modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2>üìù FORMALIZAR PROPOSTA</h2>
        <button onclick="fechar('propModal')" class="btn btn-red">X</button>
    </div>
    <input type="text" id="cNome" placeholder="Nome do Cliente">
    <input type="text" id="cLote" placeholder="Quadra e Lote">
    <input type="text" id="cRef" placeholder="Refer√™ncias">
    <div id="propPreview" style="background:#000; padding:15px; border-radius:8px; font-size:13px; border:1px solid var(--good); white-space: pre-wrap;"></div>
    <button onclick="copiarProp()" class="btn btn-green" style="width:100%; margin-top:15px; padding:15px;">COPIAR PARA WHATSAPP</button>
</div>

<div class="footer">
    <button class="btn btn-blue" onclick="copiarDocs()">üìÇ DOCS</button>
    <button class="btn btn-green" onclick="abrirProposta()">üìù PROP</button>
    <button class="btn btn-red" onclick="limpar()">üßπ LIMP</button>
    <button id="btnVoz" class="btn btn-blue" style="grid-column: span 3; background: #3b82f6;" onclick="falar()">üéôÔ∏è ESCUTA ATIVA</button>
</div>

<script>
    let db = {
        "prods": [],
        "objs": [],
        "users": [{"u": "admin", "p": "123"}],
        "lastProd": null
    };

    async function renderIndices() {
        const container = document.getElementById('indices');
        try {
            const resSelic = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.432/dados/ultimos/1?formato=json');
            const dataSelic = await resSelic.json();
            const resIpca = await fetch('https://servicodados.ibge.gov.br/api/v3/agregados/1737/periodos/-1/variaveis/63?localidades=N1[all]');
            const dataIpca = await resIpca.json();
            const ipca = dataIpca[0].resultados[0].series[0].serie[Object.keys(dataIpca[0].resultados[0].series[0].serie)[0]];
            const resIgpm = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.189/dados/ultimos/1?formato=json');
            const dataIgpm = await resIgpm.json();

            container.innerHTML = `
                <div class="idx-tag">SELIC: ${dataSelic[0].valor}%</div>
                <div class="idx-tag">IPCA 12M: ${ipca}%</div>
                <div class="idx-tag">IGP-M 12M: ${dataIgpm[0].valor}%</div>
                <div class="idx-tag">VALORIZA√á√ÉO: 18% A.A.</div>
            `;
        } catch (e) {
            container.innerHTML = `<div class="idx-tag">SELIC: 11.25%</div><div class="idx-tag">IPCA 12M: 4.5%</div><div class="idx-tag">VALORIZA√á√ÉO: 18%</div>`;
        }
    }

    function login() {
        const u = document.getElementById('uIn').value;
        const p = document.getElementById('pIn').value;
        const valid = db.users.find(user => user.u === u && user.p === p);
        if(valid) {
            document.getElementById('login').style.display='none';
            document.getElementById('btnAdm').style.display='block';
            renderIndices(); atualizarListas();
        } else alert("Acesso Negado!");
    }

    function pesquisar(v) {
        const t = v.toLowerCase().trim(); 
        const f = document.getElementById('feed'); f.innerHTML = ""; 
        if(t.length < 2) return;

        db.prods.forEach(p => {
            if(p.keys.includes(t) || p.nome.toLowerCase().includes(t)) {
                db.lastProd = p;
                const m2 = p.preco / p.area;
                const perda = (p.preco * 0.18) / 12;
                f.innerHTML += `<div class="card card-prod"><div style="display:flex; justify-content:space-between;"><h3>üìç ${p.nome}</h3><span style="background:var(--primary); font-size:9px; padding:3px 6px; border-radius:4px;">${p.prazo}</span></div><p style="font-size:11px; opacity:0.8; margin-bottom:10px;">${p.reg}</p><div class="info-grid"><div><span class="label-f">Total</span><b>R$ ${Number(p.preco).toLocaleString('pt-BR')}</b></div><div><span class="label-f">Parcela</span><b>R$ ${p.parc}</b></div><div><span class="label-f">Entrada</span><b>${p.ent}</b></div><div><span class="label-f">M¬≤</span><b>R$ ${m2.toFixed(2)}</b></div><div><span class="label-f">Reajuste</span><b>${p.reaj}</b></div><div><span class="label-f">√Årea</span><b>${p.area}m¬≤</b></div></div><div class="calc-box">üìâ Procrastinar custa <b>R$ ${perda.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</b>/m√™s em valoriza√ß√£o.</div></div>`;
            }
        });

        db.objs.forEach(o => {
            if(o.k.split(',').some(g => t.includes(g.trim()))) { 
                f.innerHTML += `<div class="card card-obj"><strong>${o.t}</strong><div style="color:#93c5fd; margin-top:5px; font-size:14px; line-height:1.4; white-space: pre-wrap;">${o.m}</div></div>`; 
            }
        });
    }

    function salvarP() {
        const i = parseInt(document.getElementById('idxP').value);
        const p = { nome: document.getElementById('p1').value, reg: document.getElementById('p2').value, keys: document.getElementById('pk').value, preco: document.getElementById('p3').value, area: document.getElementById('p4').value, ent: document.getElementById('p5').value, parc: document.getElementById('p6').value, reaj: document.getElementById('p7').value, prazo: document.getElementById('p8').value };
        if(i === -1) db.prods.push(p); else db.prods[i] = p;
        limparCamposP(); atualizarListas(); alert("Produto Salvo!");
    }

    function editP(i) {
        const p = db.prods[i];
        document.getElementById('p1').value=p.nome; document.getElementById('p2').value=p.reg; document.getElementById('p3').value=p.preco; document.getElementById('p4').value=p.area; document.getElementById('p5').value=p.ent; document.getElementById('p6').value=p.parc; document.getElementById('p7').value=p.reaj; document.getElementById('p8').value=p.prazo; document.getElementById('pk').value=p.keys; document.getElementById('idxP').value=i;
    }

    function salvarO() {
        const i = parseInt(document.getElementById('idxO').value);
        const o = { k: document.getElementById('okey').value, t: document.getElementById('otit').value, m: document.getElementById('omsg').value };
        if(i === -1) db.objs.push(o); else db.objs[i] = o;
        document.getElementById('idxO').value="-1"; document.getElementById('okey').value=""; document.getElementById('otit').value=""; document.getElementById('omsg').value="";
        atualizarListas(); alert("Obje√ß√£o Salva!");
    }

    function editO(i) {
        const o = db.objs[i];
        document.getElementById('okey').value=o.k; document.getElementById('otit').value=o.t; document.getElementById('omsg').value=o.m; document.getElementById('idxO').value=i;
    }

    function salvarU() {
        db.users.push({u: document.getElementById('unome').value, p: document.getElementById('usenha').value});
        document.getElementById('unome').value=""; document.getElementById('usenha').value="";
        atualizarListas();
    }

    function atualizarListas() {
        document.getElementById('listP').innerHTML = db.prods.map((x,i) => `<div style="display:flex; justify-content:space-between; padding:8px; background:#000; margin-top:5px; font-size:11px;"><span>${x.nome}</span><div><button onclick="editP(${i})">üìù</button><button onclick="db.prods.splice(${i},1);atualizarListas()">‚ùå</button></div></div>`).join('');
        document.getElementById('listO').innerHTML = db.objs.map((x,i) => `<div style="display:flex; justify-content:space-between; padding:8px; background:#000; margin-top:5px; font-size:11px;"><span>${x.t}</span><div><button onclick="editO(${i})">üìù</button><button onclick="db.objs.splice(${i},1);atualizarListas()">‚ùå</button></div></div>`).join('');
        document.getElementById('listU').innerHTML = db.users.map((x,i) => `<div style="display:flex; justify-content:space-between; padding:8px; background:#000; margin-top:5px; font-size:11px;"><span>üë§ ${x.u}</span><button onclick="db.users.splice(${i},1);atualizarListas()">‚ùå</button></div>`).join('');
    }

    function exportar() { 
        let h = document.documentElement.outerHTML; 
        h = h.replace(/let db = \{[\s\S]*?\};/, `let db = ${JSON.stringify(db, null, 4)};`); 
        const b = new Blob(["<!DOCTYPE html>\n"+h], {type:"text/html"}); 
        const a = document.createElement("a"); a.href = URL.createObjectURL(b); a.download = "sistema_elite_sinop.html"; a.click(); 
    }

    function abrir(id) { document.getElementById(id).style.display='block'; }
    function fechar(id) { document.getElementById(id).style.display='none'; }
    function limpar() { document.getElementById('busca').value=''; pesquisar(''); }
    function copiarDocs() { navigator.clipboard.writeText("üìÇ *DOCS:* RG/CPF, Comprovante de Resid√™ncia, Renda."); alert("Copiado!"); }
    function limparCamposP() { document.getElementById('idxP').value="-1"; ["p1","p2","p3","p4","p5","p6","p7","p8","pk"].forEach(id => document.getElementById(id).value=""); }
    
    function abrirProposta() {
        if(!db.lastProd) return;
        abrir('propModal');
        document.getElementById('propPreview').innerText = `PROPOSTA: ${db.lastProd.nome}\nVALOR: R$ ${Number(db.lastProd.preco).toLocaleString('pt-BR')}\nENTRADA: ${db.lastProd.ent}\nPARCELA: ${db.lastProd.parc}`;
    }

    function copiarProp() {
        const t = `üìù *PROPOSTA SINOP*\nLOCAL: ${db.lastProd.nome}\nVALOR: ${db.lastProd.preco}\nENTRADA: ${db.lastProd.ent}\nPARCELA: ${db.lastProd.parc}`;
        navigator.clipboard.writeText(t); alert("Copiado!");
    }

    function falar() {
        const r = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        r.lang = 'pt-BR'; r.onresult = (e) => { document.getElementById('busca').value = e.results[0][0].transcript; pesquisar(document.getElementById('busca').value); };
        r.start();
    }
</script>
</body>
</html>
