<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>COPILOTO ‚Äî Assistente de Obje√ß√µes</title>

<style>
/* ===================== DESIGN ===================== */
:root{
  --bg:#f6f7fb;
  --panel:#fff;
  --text:#0f172a;
  --muted:#475569;
  --border:#e5e7eb;

  --primary:#4c5bd4;
  --primary2:#3f4bd0;
  --ring:rgba(76,91,212,.35);

  --good:#16a34a;
  --warn:#f59e0b;
  --bad:#ef4444;

  --radius:18px;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  position:sticky;
  top:0;
  background:#fff;
  border-bottom:1px solid var(--border);
  z-index:10;
}

.topbar{
  max-width:1200px;
  margin:auto;
  padding:14px 18px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}

.brand h1{margin:0;font-size:20px;font-weight:900}
.brand span{font-size:13px;color:var(--muted)}

.statusline{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

.pill{
  padding:8px 12px;
  border-radius:999px;
  border:1px solid var(--border);
  font-size:12px;
  font-weight:700;
  background:#fff;
}

button{
  padding:12px 16px;
  border-radius:14px;
  border:1px solid var(--border);
  font-weight:800;
  background:#fff;
  cursor:pointer;
}

.primary{
  background:linear-gradient(180deg,var(--primary),var(--primary2));
  color:#fff;border:none
}
.danger{background:rgba(239,68,68,.12);border-color:rgba(239,68,68,.3);color:#7f1d1d}
.ghost{background:rgba(76,91,212,.08);border-color:rgba(76,91,212,.25)}

main{max-width:1200px;margin:auto;padding:18px}

.grid{
  display:grid;
  grid-template-columns:320px 1fr 420px;
  gap:18px;
}
@media(max-width:980px){.grid{grid-template-columns:1fr}}

.card{
  background:#fff;
  border:1px solid var(--border);
  border-radius:var(--radius);
  box-shadow:0 12px 28px rgba(0,0,0,.06);
  overflow:hidden;
}

.card .head{
  padding:16px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  gap:10px;
}
.card .body{padding:16px}

.subtitle{font-size:13px;color:var(--muted);line-height:1.4}

.productName{font-size:22px;font-weight:900}
.infoList{padding-left:18px}
.infoList li{margin:6px 0;font-size:15px}

textarea{
  width:100%;
  min-height:220px;
  padding:18px;
  font-size:17px;
  line-height:1.6;
  border-radius:16px;
  border:1px solid var(--border);
}

textarea:focus{
  outline:none;
  border-color:var(--primary);
  box-shadow:0 0 0 5px var(--ring);
}

.responseText{
  font-size:17px;
  line-height:1.65;
  white-space:pre-wrap;
}

/* ===== EFEITOS FORTES ===== */
.fxUpdate{
  animation:pulse .85s ease-out;
}
@keyframes pulse{
  0%{box-shadow:0 0 0 0 rgba(76,91,212,0)}
  35%{box-shadow:0 0 0 14px rgba(76,91,212,.3);background:rgba(76,91,212,.05)}
  100%{box-shadow:0 0 0 0 rgba(76,91,212,0)}
}

/* ===== LOGIN ===== */
.overlay{
  position:fixed;inset:0;
  background:rgba(15,23,42,.65);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:50;
}

.modal{
  background:#fff;
  padding:26px;
  border-radius:22px;
  width:min(460px,100%);
}

input{
  width:100%;
  padding:14px;
  font-size:16px;
  border-radius:14px;
  border:1px solid var(--border);
  margin-top:10px;
}

@media(max-width:600px){
  .productName{font-size:24px}
  .responseText{font-size:18px}
  button{width:100%}
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginOverlay" class="overlay">
  <div class="modal">
    <h1>Entrar no COPILOTO</h1>
    <p class="subtitle">Acesso restrito</p>

    <input id="loginUser" placeholder="Login">
    <input id="loginPass" type="password" placeholder="Senha">

    <label style="display:flex;gap:8px;margin-top:10px;font-size:14px">
      <input type="checkbox" id="rememberMe">
      Salvar neste dispositivo
    </label>

    <p id="loginError" style="color:#b91c1c;display:none;font-size:13px">Login inv√°lido</p>

    <button class="primary" style="margin-top:16px;width:100%" onclick="doLogin()">Entrar</button>
  </div>
</div>

<header>
  <div class="topbar">
    <div class="brand">
      <h1>COPILOTO</h1>
      <span>Assistente de Obje√ß√µes em Tempo Real</span>
    </div>
    <div class="statusline">
      <span class="pill" id="rolePill">Acesso: ‚Äî</span>
      <button id="adminBtn" class="ghost" style="display:none" onclick="openAdmin()">‚öôÔ∏è Admin</button>
      <button class="danger" onclick="logout()">Sair</button>
    </div>
  </div>
</header>

<main>
<div class="grid">

<!-- PRODUTO -->
<aside class="card" id="productCard">
  <div class="head">
    <div>
      <h3>Produto ativo</h3>
      <p class="subtitle">Detectado por palavras e informa√ß√µes</p>
    </div>
  </div>
  <div class="body">
    <div id="prodName" class="productName">Produto n√£o identificado</div>
    <ul id="prodInfo" class="infoList"></ul>
  </div>
</aside>

<!-- INPUT -->
<section class="card" id="inputCard">
  <div class="head">
    <div>
      <h3>Fala do cliente</h3>
      <p class="subtitle">Digite ou dite ‚Äî limpa automaticamente</p>
    </div>
  </div>
  <div class="body">
    <textarea id="input" placeholder="Digite ou dite o que o cliente disse..."></textarea>
    <div style="display:flex;gap:10px;margin-top:12px;flex-wrap:wrap">
      <button class="ghost" onclick="toggleListening()">üéôÔ∏è Microfone</button>
      <button class="danger" onclick="clearAll()">Limpar</button>
    </div>
  </div>
</section>

<!-- RESPOSTAS -->
<section class="card" id="responsesWrap">
  <div class="head"><h3>Respostas</h3></div>
  <div class="body">
    <p id="r1" class="responseText">‚Äî</p>
    <p id="r2" class="responseText">‚Äî</p>
    <p id="r3" class="responseText">‚Äî</p>
  </div>
</section>

</div>
</main>

<script>
/* ===================== BASE ===================== */
const BASE = {
  products:[
    {name:"CEDROS JARDINS",keys:["cedros","b√∫falo"],info:["Lotes 200 m¬≤","Av. Andr√© Maggi","Posto B√∫falo"]},
    {name:"MORADA BRASIL",keys:["morada"],info:["Av. Andr√© Maggi","Sem entrada"]}
  ],
  objections:[
    {keys:["caro","pre√ßo alto"],a:"Entendo. √â mais pelo valor total ou parcela?",b:"Comparado com qual op√ß√£o?",c:"Se couber no bolso voc√™ fecha agora?"},
    {keys:["vou pensar","analisar"],a:"Perfeito. O que voc√™ quer analisar?",b:"O que falta pra virar sim?",c:"Se nada mudar, sua resposta tende mais pra sim ou n√£o?"}
  ],
  users:[{login:"vendedor",pass:"1234"}]
};

/* ===================== LOGIN ===================== */
const ADMIN={login:"edson",pass:"2026"};
const LS="copiloto_session";
let currentUser=null;

function doLogin(){
  const u=loginUser.value.trim();
  const p=loginPass.value.trim();
  loginError.style.display="none";

  if(u===ADMIN.login && p===ADMIN.pass){
    currentUser={login:u,role:"admin"};
  }else{
    const found=BASE.users.find(x=>x.login===u&&x.pass===p);
    if(!found){loginError.style.display="block";return;}
    currentUser={login:u,role:"user"};
  }

  const store=rememberMe.checked?localStorage:sessionStorage;
  store.setItem(LS,JSON.stringify(currentUser));
  afterLogin();
}

function afterLogin(){
  loginOverlay.style.display="none";
  rolePill.textContent=`Acesso: ${currentUser.role} (${currentUser.login})`;
  adminBtn.style.display=currentUser.role==="admin"?"inline-flex":"none";
}

function logout(){
  localStorage.removeItem(LS);
  sessionStorage.removeItem(LS);
  location.reload();
}

/* ===================== MATCH ===================== */
const input=document.getElementById("input");
const r1=document.getElementById("r1");
const r2=document.getElementById("r2");
const r3=document.getElementById("r3");
const prodName=document.getElementById("prodName");
const prodInfo=document.getElementById("prodInfo");

let lastProduct=null;
let clearTimer=null;

function norm(t){
  return t.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9\s]/g," ");
}

function processText(){
  const t=norm(input.value);

  // PRODUTO
  const p=BASE.products.find(p=>
    [...p.keys,...p.info].some(k=>t.includes(norm(k))) && !t.includes("sinop")
  );
  if(p){
    lastProduct=p;
    prodName.textContent=p.name;
    prodInfo.innerHTML=p.info.map(i=>"<li>"+i+"</li>").join("");
    productCard.classList.add("fxUpdate");
    setTimeout(()=>productCard.classList.remove("fxUpdate"),900);
  }else if(lastProduct){
    prodName.textContent=lastProduct.name;
    prodInfo.innerHTML=lastProduct.info.map(i=>"<li>"+i+"</li>").join("");
  }

  // OBJE√á√ÉO
  const o=BASE.objections.find(o=>o.keys.some(k=>t.includes(norm(k))));
  if(o){
    r1.textContent=o.a;
    r2.textContent=o.b;
    r3.textContent=o.c;
    responsesWrap.classList.add("fxUpdate");
    setTimeout(()=>responsesWrap.classList.remove("fxUpdate"),900);
  }

  clearTimeout(clearTimer);
  clearTimer=setTimeout(()=>input.value="",900);
}

input.addEventListener("input",processText);

/* ===================== MICROFONE ===================== */
let rec=null;
function toggleListening(){
  if(!('webkitSpeechRecognition'in window)){alert("Sem suporte");return;}
  rec=new webkitSpeechRecognition();
  rec.lang="pt-BR";
  rec.onresult=e=>{
    input.value=e.results[0][0].transcript;
    processText();
  };
  rec.start();
}

/* ===================== INIT ===================== */
(function(){
  const s=localStorage.getItem(LS)||sessionStorage.getItem(LS);
  if(s){currentUser=JSON.parse(s);afterLogin();}
})();
</script>

</body>
</html>
