<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SISTEMA ELITE SINOP V26</title>
    <style>
        :root { --bg: #05070a; --card: #111827; --primary: #2563eb; --good: #10b981; --bad: #ef4444; --gold: #f59e0b; --border: #374151; }
        * { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; }
        body { background: var(--bg); color: #fff; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
        header { background: #000; padding: 12px; border-bottom: 3px solid var(--primary); display: flex; justify-content: space-between; align-items: center; }
        .idx-tag { background: #1f2937; padding: 6px 10px; border-radius: 6px; font-size: 11px; border: 1px solid var(--gold); color: var(--gold); font-weight: bold; margin-right: 5px; white-space: nowrap; }
        main { flex: 1; padding: 15px; overflow-y: auto; padding-bottom: 180px; }
        .busca-master { width: 100%; padding: 18px; border-radius: 12px; border: 3px solid var(--primary); background: #000; color: #fff; font-size: 18px; font-weight: bold; margin-bottom: 20px; box-shadow: 0 0 15px rgba(37, 99, 235, 0.3); }
        .card { background: var(--card); border-radius: 12px; padding: 16px; border: 2px solid var(--border); margin-bottom: 15px; position: relative; }
        .card-prod { border-left: 8px solid var(--primary); }
        .card-obj { border-left: 8px solid var(--gold); }
        .btn { padding: 12px; border: none; border-radius: 8px; font-weight: 900; cursor: pointer; text-transform: uppercase; font-size: 11px; text-align: center; color: #ffffff !important; transition: 0.2s; }
        .btn-blue { background: #2563eb; }
        .btn-green { background: #059669; }
        .btn-red { background: #dc2626; }
        .btn-gold { background: #f59e0b; color: #000 !important; }
        .label-f { display: block; font-size: 10px; color: var(--gold); font-weight: bold; margin-bottom: 4px; text-transform: uppercase; }
        input, textarea, select { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #4b5563; background: #000; color: #fff; margin-bottom: 10px; font-size: 14px; }
        .modal { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; padding: 20px; overflow-y: auto; }
        .footer { position: fixed; bottom: 0; width: 100%; background: #000; padding: 15px; border-top: 3px solid var(--primary); display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; z-index: 1000; }
        .calc-box { background: rgba(239, 68, 68, 0.1); border: 1px solid var(--bad); padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 12px; color: #fca5a5; }
        .admin-section { margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
    </style>
</head>
<body>

<div id="login" style="position:fixed; inset:0; background:#000; z-index:5000; display:flex; align-items:center; justify-content:center; padding:20px;">
    <div class="card" style="width:100%; max-width:350px; text-align:center;">
        <h2 style="color:var(--primary); margin-bottom:20px;">ELITE SINOP V26</h2>
        <input type="text" id="uIn" placeholder="Corretor">
        <input type="password" id="pIn" placeholder="Senha">
        <button onclick="login()" class="btn btn-blue" style="width:100%; padding:15px;">ACESSAR PAINEL</button>
    </div>
</div>

<header>
    <div style="display:flex; overflow-x:auto; padding-bottom: 5px;" id="indices">
        <div class="idx-tag">CARREGANDO √çNDICES...</div>
    </div>
    <button onclick="abrir('adm')" class="btn btn-gold" id="btnAdm" style="display:none; margin-left:10px;">GESTOR ‚öôÔ∏è</button>
</header>

<main>
    <input type="text" id="busca" class="busca-master" placeholder="Busque: SPC, MAGGI, AGRO, CARO..." oninput="pesquisar(this.value)">
    <div id="feed"></div>
</main>

<div id="adm" class="modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2>‚öôÔ∏è CENTRAL DE CONTROLE</h2>
        <button onclick="fechar('adm')" class="btn btn-red">SAIR</button>
    </div>
    <div class="admin-section">
        <h3 style="color:var(--primary)">üì¶ PRODUTOS</h3>
        <input type="hidden" id="idxP" value="-1">
        <input type="text" id="p1" placeholder="Nome do Loteamento">
        <input type="text" id="p2" placeholder="Regi√£o">
        <input type="text" id="pk" placeholder="Gatilhos (separados por v√≠rgula)">
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="number" id="p3" placeholder="Pre√ßo Total">
            <input type="number" id="p4" placeholder="√Årea M¬≤">
            <input type="text" id="p5" placeholder="Entrada">
            <input type="text" id="p6" placeholder="Parcela">
        </div>
        <button onclick="salvarP()" class="btn btn-green" style="width:100%">SALVAR PRODUTO</button>
        <div id="listP" style="max-height:150px; overflow-y:auto; margin-top:10px;"></div>
    </div>
    <div class="admin-section">
        <h3 style="color:var(--gold)">üõ°Ô∏è OBJE√á√ïES</h3>
        <input type="hidden" id="idxO" value="-1">
        <input type="text" id="okey" placeholder="Gatilho">
        <input type="text" id="otit" placeholder="T√≠tulo">
        <textarea id="omsg" placeholder="Script" rows="5"></textarea>
        <button onclick="salvarO()" class="btn btn-green" style="width:100%">SALVAR OBJE√á√ÉO</button>
        <div id="listO" style="max-height:150px; overflow-y:auto; margin-top:10px;"></div>
    </div>
    <button onclick="exportar()" class="btn btn-blue" style="width:100%; padding:20px; margin-top:10px;">üíæ AUTO-BUILD (GERAR NOVO HTML)</button>
</div>

<div id="propModal" class="modal">
    <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
        <h2>üìù FORMALIZAR PROPOSTA</h2>
        <button onclick="fechar('propModal')" class="btn btn-red">X</button>
    </div>
    <input type="text" id="cNome" placeholder="Nome do Cliente">
    <input type="text" id="cLote" placeholder="Quadra e Lote">
    <input type="text" id="cRef" placeholder="Refer√™ncias">
    <div id="propPreview" style="background:#000; padding:15px; border-radius:8px; font-size:13px; border:1px solid var(--good); white-space: pre-wrap;"></div>
    <button onclick="copiarProp()" class="btn btn-green" style="width:100%; margin-top:15px; padding:15px;">COPIAR PARA WHATSAPP</button>
</div>

<div class="footer">
    <button class="btn btn-blue" onclick="copiarDocs()">üìÇ DOCS</button>
    <button class="btn btn-green" onclick="abrirProposta()">üìù PROP</button>
    <button class="btn btn-red" onclick="limpar()">üßπ LIMP</button>
    <button id="btnVoz" class="btn btn-blue" style="grid-column: span 3; background: #3b82f6;" onclick="falar()">üéôÔ∏è ESCUTA ATIVA</button>
</div>

<script>
    let db = {
    "prods": [
        { "nome": "CEDROS JARDINS", "reg": "Posto B√∫falo", "preco": "145000", "area": "200", "ent": "SEM ENTRADA", "parc": "753,00", "keys": "spc, cedros, bufalo" },
        { "nome": "MORADA BRASIL", "reg": "Andr√© Maggi", "preco": "175000", "area": "300", "ent": "R$ 5.000", "parc": "890,00", "keys": "maggi, morada, elite" }
    ],
    "objs": [
        { "k": "caro, preco", "t": "üí∞ OBJE√á√ÉO: PRE√áO", "m": "1. Caro comparado a qu√™? Sinop valoriza 18% ao ano.\n2. Se a parcela cabe no bolso, o pre√ßo √© investimento." },
        { "k": "esposa, marido, conjuge", "t": "üíé FAM√çLIA", "m": "1. Decis√µes em fam√≠lia s√£o seguras. Mas ela costuma ser contra patrim√¥nio?\n2. Segure a unidade; se ela n√£o aprovar, devolvemos a reserva." }
    ],
    "users": [
        {"u": "admin", "p": "123"},
        {"u": "elite", "p": "sinop2026"}
    ],
    "lastProd": null
};

    // NOVA FUN√á√ÉO: BUSCA AUTOM√ÅTICA DE TAXAS
    async function renderIndices() {
        const container = document.getElementById('indices');
        try {
            // Busca SELIC (BCB)
            const resSelic = await fetch('https://api.bcb.gov.br/dados/serie/bcdata.sgs.11/dados/ultimos/1?formato=json');
            const dataSelic = await resSelic.json();
            const selic = dataSelic[0].valor;

            // Busca IPCA (IBGE)
            const resIpca = await fetch('https://servicodados.ibge.gov.br/api/v3/agregados/1737/periodos/-1/variaveis/63?localidades=N1[all]');
            const dataIpca = await resIpca.json();
            const ipca = dataIpca[0].resultados[0].series[0].serie[Object.keys(dataIpca[0].resultados[0].series[0].serie)[0]];

            container.innerHTML = `
                <div class="idx-tag">SELIC: ${selic}%</div>
                <div class="idx-tag">IPCA: ${ipca}% (ACUM)</div>
                <div class="idx-tag">IGP-M: 0,89% (ESTIMADO)</div>
                <div class="idx-tag">VALORIZA√á√ÉO SINOP: 18% A.A.</div>
            `;
        } catch (e) {
            // Fallback caso a API falhe
            container.innerHTML = `
                <div class="idx-tag">SELIC: 11.25%</div>
                <div class="idx-tag">IPCA: 4.5%</div>
                <div class="idx-tag">VALORIZA√á√ÉO SINOP: 18% A.A.</div>
            `;
        }
    }

    // Fun√ß√µes Originais Mantidas
    function login() {
        const u = document.getElementById('uIn').value;
        const p = document.getElementById('pIn').value;
        const valid = db.users.find(user => user.u === u && user.p === p);
        if(valid) {
            document.getElementById('login').style.display='none';
            document.getElementById('btnAdm').style.display='block';
            renderIndices(); atualizarListas();
        } else alert("Acesso Negado!");
    }

    function pesquisar(v) {
        const t = v.toLowerCase().replace('?', '').trim(); 
        const f = document.getElementById('feed'); f.innerHTML = ""; 
        if(t.length < 2) return;
        db.prods.forEach(p => {
            if(p.keys.includes(t) || p.nome.toLowerCase().includes(t)) {
                db.lastProd = p;
                const m2 = p.preco / p.area;
                const perda = (p.preco * 0.18) / 12;
                f.innerHTML += `<div class="card card-prod"><h3>üìç ${p.nome}</h3><p style="font-size:11px; opacity:0.8">${p.reg}</p><div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-top:10px; background:#000; padding:10px; border-radius:8px;"><div><span class="label-f">M¬≤</span><b>R$ ${m2.toFixed(2)}</b></div><div><span class="label-f">PARCELA</span><b>R$ ${p.parc}</b></div><div><span class="label-f">ENTRADA</span><b>${p.ent}</b></div><div><span class="label-f">TOTAL</span><b>R$ ${Number(p.preco).toLocaleString()}</b></div></div><div class="calc-box">üìâ Procrastinar te custa <b>R$ ${perda.toLocaleString('pt-BR')}</b> de valoriza√ß√£o este m√™s.</div></div>`;
            }
        });
        db.objs.forEach(o => {
            const gatilhos = o.k.split(',').map(s => s.trim());
            if(gatilhos.some(g => t.includes(g))) { 
                f.innerHTML += `<div class="card card-obj"><strong>${o.t}</strong><div style="color:#93c5fd; margin-top:5px; font-size:14px; line-height:1.4; white-space: pre-wrap;">${o.m}</div></div>`; 
            }
        });
    }

    function salvarP() {
        const i = parseInt(document.getElementById('idxP').value);
        const p = { nome: document.getElementById('p1').value, reg: document.getElementById('p2').value, keys: document.getElementById('pk').value, preco: document.getElementById('p3').value, area: document.getElementById('p4').value, ent: document.getElementById('p5').value, parc: document.getElementById('p6').value };
        if(i === -1) db.prods.push(p); else db.prods[i] = p;
        limparCamposP(); atualizarListas(); alert("Salvo!");
    }
    function editP(i) {
        const p = db.prods[i];
        document.getElementById('p1').value=p.nome; document.getElementById('p2').value=p.reg; document.getElementById('p3').value=p.preco; document.getElementById('p4').value=p.area; document.getElementById('p5').value=p.ent; document.getElementById('p6').value=p.parc; document.getElementById('pk').value=p.keys; document.getElementById('idxP').value=i;
    }
    function salvarO() {
        const i = parseInt(document.getElementById('idxO').value);
        const o = { k: document.getElementById('okey').value, t: document.getElementById('otit').value, m: document.getElementById('omsg').value };
        if(i === -1) db.objs.push(o); else db.objs[i] = o;
        atualizarListas(); alert("Salvo!");
    }
    function editO(i) {
        const o = db.objs[i];
        document.getElementById('okey').value=o.k; document.getElementById('otit').value=o.t; document.getElementById('omsg').value=o.m; document.getElementById('idxO').value=i;
    }
    function atualizarListas() {
        document.getElementById('listP').innerHTML = db.prods.map((x,i) => `<div style="display:flex; justify-content:space-between; padding:8px; background:#000; margin-top:5px; font-size:12px;"><span>${x.nome}</span><button onclick="editP(${i})">üìù</button></div>`).join('');
        document.getElementById('listO').innerHTML = db.objs.map((x,i) => `<div style="display:flex; justify-content:space-between; padding:8px; background:#000; margin-top:5px; font-size:12px;"><span>${x.t}</span><button onclick="editO(${i})">üìù</button></div>`).join('');
    }
    function exportar() { 
        let h = document.documentElement.outerHTML; 
        h = h.replace(/let db = \{[\s\S]*?\};/, `let db = ${JSON.stringify(db, null, 4)};`); 
        const b = new Blob(["<!DOCTYPE html>\n"+h], {type:"text/html"}); 
        const a = document.createElement("a"); a.href = URL.createObjectURL(b); a.download = "sistema_elite_sinop.html"; a.click(); 
    }
    function abrir(id) { document.getElementById(id).style.display='block'; }
    function fechar(id) { document.getElementById(id).style.display='none'; }
    function limpar() { document.getElementById('busca').value=''; pesquisar(''); }
    function falar() {
        const r = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        r.lang = 'pt-BR'; r.onresult = (e) => { 
            const t = e.results[0][0].transcript;
            document.getElementById('busca').value = t; pesquisar(t); 
        }; r.start();
    }
    function abrirProposta() {
        if(!db.lastProd) { alert("Selecione um produto!"); return; }
        abrir('propModal');
        document.getElementById('propPreview').innerText = `PROPOSTA: ${db.lastProd.nome}\nPARCELA: ${db.lastProd.parc}`;
    }
    function copiarProp() {
        const texto = `üìù *PROPOSTA FORMAL*\nLOCAL: ${db.lastProd.nome}\nLOTE: ${document.getElementById('cLote').value}\nPARCELA: ${db.lastProd.parc}`;
        navigator.clipboard.writeText(texto); alert("Copiado!");
    }
    function copiarDocs() { navigator.clipboard.writeText("üìÇ *DOCS:* RG/CPF, Comprovante de Resid√™ncia."); alert("Copiado!"); }
    function limparCamposP() { document.getElementById('idxP').value="-1"; ["p1","p2","p3","p4","p5","p6","pk"].forEach(id => document.getElementById(id).value=""); }
</script>
</body>
</html>
