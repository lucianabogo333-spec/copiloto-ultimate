<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Copiloto ‚Äî Assistente de Obje√ß√µes em Tempo Real</title>

<style>
  :root{
    --bg:#f6f7fb;
    --panel:#ffffff;
    --text:#111827;
    --muted:#6b7280;
    --border:#e5e7eb;
    --shadow: 0 10px 26px rgba(17,24,39,.08);
    --shadow2: 0 6px 16px rgba(17,24,39,.07);

    --primary:#4c5bd4;
    --primary-2:#3f4bd0;
    --ring: rgba(76,91,212,.18);

    --good:#16a34a;
    --warn:#f59e0b;
    --bad:#ef4444;

    --chip:#f3f4f6;
    --chipText:#111827;

    --radius:14px;
    --radius2:18px;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    color:var(--text);
    background:
      radial-gradient(900px 400px at 12% 0%, rgba(76,91,212,.10), transparent 55%),
      radial-gradient(900px 520px at 92% 12%, rgba(245,158,11,.09), transparent 55%),
      var(--bg);
  }

  /* Header */
  header{
    position:sticky; top:0; z-index:5;
    background:rgba(255,255,255,.86);
    backdrop-filter: blur(10px);
    border-bottom:1px solid var(--border);
  }
  .topbar{
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 18px;
    max-width:1200px; margin:0 auto;
    gap:12px;
  }
  .brand{
    display:flex; flex-direction:column; gap:2px;
  }
  .brand h1{
    margin:0; font-size:18px; letter-spacing:.2px;
  }
  .brand span{
    font-size:12px; color:var(--muted);
  }
  .statusline{
    display:flex; align-items:center; gap:10px; flex-wrap:wrap;
  }
  .pill{
    display:inline-flex; align-items:center; gap:8px;
    padding:7px 10px;
    border:1px solid var(--border);
    border-radius:999px;
    background:#fff;
    box-shadow: 0 1px 0 rgba(17,24,39,.02);
    font-size:12px;
    color:var(--muted);
  }
  .dot{
    width:8px; height:8px; border-radius:999px;
    background: #cbd5e1;
  }
  .dot.on{background: var(--good)}
  .kbd{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    font-size:11px;
    padding:2px 6px;
    border:1px solid var(--border);
    border-bottom-color:#d1d5db;
    background:#fff;
    border-radius:8px;
    color:#374151;
  }

  /* Layout */
  main{
    max-width:1200px;
    margin:0 auto;
    padding:18px;
  }
  .grid{
    display:grid;
    grid-template-columns: 300px 1fr 420px;
    gap:16px;
    align-items:start;
  }

  /* Cards */
  .card{
    background:var(--panel);
    border:1px solid var(--border);
    border-radius:var(--radius);
    box-shadow: var(--shadow2);
    overflow:hidden;
  }
  .card .head{
    padding:14px 14px 10px;
    border-bottom:1px solid rgba(229,231,235,.75);
    display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
  }
  .card .body{
    padding:14px;
  }
  .title{
    display:flex; flex-direction:column; gap:4px;
  }
  .title h2, .title h3, .title h4{
    margin:0;
    font-weight:700;
    letter-spacing:.2px;
  }
  .title h2{font-size:14px}
  .title h3{font-size:14px}
  .subtitle{
    margin:0;
    font-size:12px;
    color:var(--muted);
    line-height:1.35;
  }

  .chip{
    display:inline-flex; align-items:center; gap:6px;
    padding:6px 9px;
    border-radius:999px;
    background:var(--chip);
    color:var(--chipText);
    border:1px solid rgba(229,231,235,.9);
    font-size:12px;
    white-space:nowrap;
  }
  .chip.good{background: rgba(22,163,74,.10); border-color: rgba(22,163,74,.22); color:#065f46}
  .chip.warn{background: rgba(245,158,11,.12); border-color: rgba(245,158,11,.25); color:#7c2d12}
  .chip.bad{background: rgba(239,68,68,.11); border-color: rgba(239,68,68,.24); color:#7f1d1d}

  .updated-badge{
    display:none;
    align-items:center;
    gap:6px;
    padding:6px 9px;
    border-radius:999px;
    background: rgba(76,91,212,.10);
    border: 1px solid rgba(76,91,212,.22);
    color: #1f2a9a;
    font-size:12px;
    white-space:nowrap;
  }
  .updated-badge.show{display:inline-flex}

  /* Product card */
  .productName{
    font-size:16px;
    margin:0;
    line-height:1.2;
  }
  .productMeta{
    padding:10px 14px 14px;
    display:flex; flex-direction:column; gap:10px;
  }
  .infoList{
    margin:0;
    padding-left:18px;
    color:#111827;
  }
  .infoList li{
    margin:6px 0;
    color:#111827;
    font-size:13px;
    line-height:1.35;
  }
  .hint{
    font-size:12px;
    color:var(--muted);
    margin:0;
  }

  /* Input */
  .inputWrap{
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  textarea{
    width:100%;
    min-height:240px;
    resize:vertical;
    padding:14px 14px;
    font-size:14px;
    line-height:1.55;
    border-radius:12px;
    border:1px solid var(--border);
    outline:none;
    background:#fff;
    box-shadow: 0 1px 0 rgba(17,24,39,.03);
  }
  textarea:focus{
    border-color: rgba(76,91,212,.45);
    box-shadow: 0 0 0 4px var(--ring);
  }
  .toolbar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
    justify-content:space-between;
  }
  .btnRow{
    display:flex;
    gap:10px;
    align-items:center;
    flex-wrap:wrap;
  }

  button{
    border:1px solid rgba(229,231,235,.9);
    background:#fff;
    color:#111827;
    padding:10px 12px;
    border-radius:12px;
    cursor:pointer;
    font-weight:600;
    font-size:13px;
    box-shadow: 0 2px 0 rgba(17,24,39,.03);
    transition: transform .06s ease, box-shadow .16s ease, border-color .16s ease;
    user-select:none;
  }
  button:hover{
    border-color: rgba(76,91,212,.30);
    box-shadow: 0 10px 20px rgba(17,24,39,.08);
  }
  button:active{transform: translateY(1px)}
  .primary{
    background: linear-gradient(180deg, var(--primary), var(--primary-2));
    color:#fff;
    border:none;
  }
  .primary:hover{box-shadow: 0 12px 22px rgba(76,91,212,.20)}
  .danger{
    background: rgba(239,68,68,.10);
    border-color: rgba(239,68,68,.22);
    color:#7f1d1d;
  }

  /* Responses */
  .responsesGrid{
    display:flex;
    flex-direction:column;
    gap:12px;
  }
  .responseCard .body{
    padding-top:12px;
    display:flex;
    flex-direction:column;
    gap:10px;
  }
  .responseText{
    margin:0;
    font-size:14px;
    line-height:1.55;
    color:#111827;
    white-space:pre-wrap;
  }
  .responseFooter{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
    flex-wrap:wrap;
  }
  .levelTag{
    display:inline-flex;
    align-items:center;
    gap:8px;
  }

  /* Effects */
  .fx{
    position:relative;
  }
  .fxPulse{
    animation: pulseGlow 650ms ease-out 1;
  }
  .fxSlideFade{
    animation: slideFadeIn 260ms ease-out 1;
  }
  @keyframes slideFadeIn{
    from{opacity:.35; transform: translateY(6px)}
    to{opacity:1; transform: translateY(0)}
  }
  @keyframes pulseGlow{
    0%{box-shadow: 0 0 0 0 rgba(76,91,212,.00)}
    30%{box-shadow: 0 0 0 6px rgba(76,91,212,.18)}
    100%{box-shadow: 0 0 0 0 rgba(76,91,212,.00)}
  }
  .highlightBorder{
    border-color: rgba(76,91,212,.45) !important;
  }

  /* Toast */
  .toast{
    position: fixed;
    right: 16px;
    bottom: 16px;
    z-index: 20;
    display:none;
    align-items:center;
    gap:10px;
    padding:12px 14px;
    border-radius:14px;
    background: rgba(17,24,39,.92);
    color:#fff;
    border:1px solid rgba(255,255,255,.10);
    box-shadow: 0 16px 30px rgba(0,0,0,.18);
    max-width: min(420px, calc(100vw - 32px));
    font-size:13px;
  }
  .toast.show{display:flex}
  .toast .mini{
    width:10px; height:10px; border-radius:999px; background: var(--good);
  }

  /* Modal */
  .modal-overlay{
    position:fixed; inset:0;
    background:rgba(17,24,39,.55);
    display:flex; align-items:center; justify-content:center;
    z-index:10;
    padding:16px;
  }
  .modal{
    width:min(520px, 100%);
    background: #fff;
    border:1px solid rgba(229,231,235,.9);
    border-radius: var(--radius2);
    box-shadow: var(--shadow);
    overflow:hidden;
  }
  .modal .mHead{
    padding:18px 18px 0;
  }
  .modal .mHead h1{
    margin:0;
    font-size:20px;
    letter-spacing:.3px;
  }
  .modal .mHead h3{
    margin:8px 0 0;
    font-size:14px;
    color:var(--muted);
    font-weight:600;
  }
  .modal .mBody{
    padding:14px 18px 18px;
    color:#374151;
    line-height:1.55;
    font-size:14px;
  }
  .modal-actions{
    display:flex;
    justify-content:flex-end;
    gap:10px;
    padding:0 18px 18px;
  }

  /* Mobile */
  @media (max-width: 980px){
    .grid{
      grid-template-columns: 1fr;
      gap:14px;
    }
    /* ordem: Produto ‚Üí Obje√ß√£o ‚Üí Respostas */
    .area-product{order:1}
    .area-input{order:2}
    .area-resp{order:3}

    textarea{min-height:210px}
    .topbar{padding:12px 14px}
  }
</style>
</head>

<body>

<!-- MODAL -->
<div id="welcome" class="modal-overlay">
  <div class="modal">
    <div class="mHead">
      <h1>COPILOTO</h1>
      <h3>Assistente de Obje√ß√µes em Tempo Real</h3>
    </div>
    <div class="mBody">
      Copiloto ajuda vendedores a lembrar informa√ß√µes do produto e quebrar obje√ß√µes em tempo real,
      com respostas curtas, humanas e com dire√ß√£o clara.
      <br><br>
      <strong>Dica:</strong> digite (ou dite) o que o cliente falou. Quando o sistema identificar um produto ou obje√ß√£o,
      voc√™ ver√° um destaque visual de ‚ÄúAtualizado‚Äù.
    </div>
    <div class="modal-actions">
      <button onclick="closeModal()">Fechar</button>
      <button class="primary" onclick="closeModal()">Come√ßar</button>
    </div>
  </div>
</div>

<header>
  <div class="topbar">
    <div class="brand">
      <h1>COPILOTO</h1>
      <span>Assistente de Obje√ß√µes em Tempo Real</span>
    </div>

    <div class="statusline">
      <div class="pill" title="Microfone manual (n√£o fica escutando infinito)">
        <span class="dot" id="micDot"></span>
        <span id="micLabel">Microfone: desligado</span>
      </div>
      <div class="pill" title="Atalhos √∫teis">
        <span class="kbd">Ctrl</span><span class="kbd">K</span>
        <span style="color:var(--muted)">Limpar</span>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="grid">

    <!-- PRODUTO -->
    <aside class="card area-product fx" id="productCard">
      <div class="head">
        <div class="title">
          <h2>Produto ativo</h2>
          <p class="subtitle">Detectado pelo texto. Se n√£o houver novo match, mant√©m o √∫ltimo.</p>
        </div>
        <div class="updated-badge" id="prodBadge">‚ú® Atualizado</div>
      </div>

      <div class="productMeta">
        <h3 class="productName" id="prod-name">Produto n√£o identificado</h3>
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <span class="chip good" id="prodChip">‚Äî</span>
          <span class="chip" id="prodHintChip">Digite palavras do produto (ex.: ‚Äúmorada‚Äù, ‚Äúcedros‚Äù, ‚Äúb√∫falo‚Äù...)</span>
        </div>
        <ul class="infoList" id="prod-info"></ul>
        <p class="hint">Sugest√£o: mantenha o texto do cliente ‚Äúcru‚Äù. O sistema procura palavras-chave e atualiza na hora.</p>
      </div>
    </aside>

    <!-- OBJE√á√ÉO (INPUT) -->
    <section class="card area-input fx" id="inputCard">
      <div class="head">
        <div class="title">
          <h3>Fala do cliente</h3>
          <p class="subtitle">Digite ou dite. O sistema identifica obje√ß√£o e sugere respostas (leve / m√©dia / agressiva).</p>
        </div>
        <div class="updated-badge" id="objBadge">‚ö° Atualizado</div>
      </div>

      <div class="body inputWrap">
        <textarea id="input" placeholder="Digite ou dite o que o cliente disse..."></textarea>

        <div class="toolbar">
          <div class="btnRow">
            <button class="primary" id="micBtn" onclick="toggleListening()">üéôÔ∏è Ouvir microfone</button>
            <button class="danger" onclick="clearAll()">Limpar</button>
          </div>

          <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-end;">
            <span class="chip" id="objChip">Obje√ß√£o: ‚Äî</span>
          </div>
        </div>
      </div>
    </section>

    <!-- RESPOSTAS -->
    <section class="responsesGrid area-resp fx" id="responsesWrap">

      <div class="card responseCard">
        <div class="head">
          <div class="title">
            <h4>Quebra Leve</h4>
            <p class="subtitle">Acolhe + direciona com pergunta (ideal pra cliente frio).</p>
          </div>
          <span class="chip good">Leve</span>
        </div>
        <div class="body">
          <p id="r1" class="responseText">‚Äî</p>
          <div class="responseFooter">
            <div class="levelTag">
              <span class="chip" id="tip1">Tom: humano e consultivo</span>
            </div>
            <button onclick="copy('r1')">Copiar</button>
          </div>
        </div>
      </div>

      <div class="card responseCard">
        <div class="head">
          <div class="title">
            <h4>Quebra M√©dia</h4>
            <p class="subtitle">Reenquadra + pede crit√©rio (puxa pra pr√≥xima etapa).</p>
          </div>
          <span class="chip warn">M√©dia</span>
        </div>
        <div class="body">
          <p id="r2" class="responseText">‚Äî</p>
          <div class="responseFooter">
            <div class="levelTag">
              <span class="chip" id="tip2">Tom: firme, sem press√£o</span>
            </div>
            <button onclick="copy('r2')">Copiar</button>
          </div>
        </div>
      </div>

      <div class="card responseCard">
        <div class="head">
          <div class="title">
            <h4>Quebra Agressiva</h4>
            <p class="subtitle">Custo da ina√ß√£o + pergunta de decis√£o (sem grosseria).</p>
          </div>
          <span class="chip bad">Agressiva</span>
        </div>
        <div class="body">
          <p id="r3" class="responseText">‚Äî</p>
          <div class="responseFooter">
            <div class="levelTag">
              <span class="chip" id="tip3">Tom: direto e objetivo</span>
            </div>
            <button onclick="copy('r3')">Copiar</button>
          </div>
        </div>
      </div>

    </section>

  </div>
</main>

<!-- TOAST -->
<div class="toast" id="toast">
  <span class="mini"></span>
  <span id="toastText">Copiado!</span>
</div>

<script>
/* ================= PRODUTOS (mantido) ================= */
const products = [
  {name:"MORADA BRASIL", keys:["morada"], info:["Loteamento residencial","Parcelas a partir de R$ 713","Entrada: n√£o","Av. Andr√© Maggi"]},
  {name:"CASA PRONTA ‚Äì SINOP", keys:["casa","mcmv"], info:["Casa 2 quartos","Parcelas a partir de R$ 699","Entrada: R$ 1.500","Financiamento Caixa"]},
  {name:"CH√ÅCARAS ‚Äì SANTA CARMEM", keys:["chacara","ch√°cara"], info:["1.800 m¬≤","Parcelas a partir de R$ 695","Entrada: n√£o","6 km de Santa Carmem"]},
  {name:"GRAN CAN√ÅRIO", keys:["canario","gran"], info:["Loteamento urbano","Parcelas a partir de R$ 595","Entrada: sim / n√£o","MT-140"]},
  {name:"CEDROS JARDINS", keys:["cedros","b√∫falo"], info:["Lotes 200 m¬≤","Parcelas a partir de R$ 753","Entrada: n√£o","Posto B√∫falo"]}
];

/* ================= OBJE√á√ïES (mais completas, sem mudar regra de match) =================
   Regras mantidas: detec√ß√£o por keywords (includes), retorna 3 respostas (a,b,c).
*/
const objections = [
  { keys:["caro","muito caro","valor alto","pre√ßo alto"],
    a:"Entendo totalmente. S√≥ pra eu te orientar certo: quando voc√™ diz caro, √© pelo valor total ou pela parcela?",
    b:"Caro comparado com qual op√ß√£o? Se for s√≥ condi√ß√£o, eu consigo te mostrar o melhor encaixe pro seu bolso.",
    c:"Se eu ajustar pra caber sem te apertar (entrada/parcela/prazo), voc√™ avan√ßa agora ou ainda fica em d√∫vida?"
  },
  { keys:["or√ßamento","sem or√ßamento","estourado","limite","apertado"],
    a:"Faz sentido cuidar do or√ßamento. Qual faixa mensal fica confort√°vel pra voc√™ hoje?",
    b:"O ponto √© a parcela ou o prazo? Se me disser o limite, eu te passo a melhor configura√ß√£o.",
    c:"Se eu encaixar dentro do seu limite sem surpresa, voc√™ d√° o pr√≥ximo passo ou prefere encerrar?"
  },
  { keys:["vou pensar","pensar","analisar","vou analisar","ver depois","vou ver"],
    a:"Perfeito, analisar √© o certo. O que voc√™ quer avaliar primeiro: pre√ßo, condi√ß√£o ou localiza√ß√£o?",
    b:"Pra sua an√°lise n√£o virar s√≥ ‚Äúdeixar pra depois‚Äù: o que precisa acontecer pra virar um sim?",
    c:"Se nada mudar nas condi√ß√µes, sua resposta tende mais pra sim ou pra n√£o? S√≥ pra eu n√£o te prender aqui."
  },
  { keys:["depois","mais pra frente","n√£o agora","agora n√£o","outro momento","n√£o √© o momento"],
    a:"Tudo bem. O que faz n√£o ser o momento: grana, prioridade ou inseguran√ßa?",
    b:"S√≥ pra eu te ajudar: quando seria um bom timing? Semana que vem, m√™s que vem‚Ä¶ o que voc√™ tem em mente?",
    c:"Se a condi√ß√£o mudar e ficar pior depois, tudo bem pra voc√™? Ou prefere garantir agora e ir ajustando no caminho?"
  },
  { keys:["esposa","marido","familia","fam√≠lia","minha mulher","meu marido"],
    a:"Claro, faz sentido alinhar. O que ela(e) costuma perguntar primeiro: parcela, localiza√ß√£o ou seguran√ßa?",
    b:"Me diz a d√∫vida principal dele(a) que eu te mando uma mensagem curta pronta pra voc√™ encaminhar.",
    c:"Se ele(a) disser ok com a condi√ß√£o, voc√™ fecha? Porque a√≠ eu te ajudo a conduzir do jeito mais r√°pido."
  },
  { keys:["comparar","comparando","vou ver outro","outros","mais barato em outro lugar","tem outro"],
    a:"Normal comparar. Voc√™ t√° comparando mais pelo pre√ßo ou pela localiza√ß√£o?",
    b:"Pra comparar certo, olha 3 pontos: documenta√ß√£o, acesso/local e potencial de valoriza√ß√£o. Qual deles te chama mais aten√ß√£o?",
    c:"Se eu te provar que aqui faz mais sentido no conjunto (n√£o s√≥ no pre√ßo), voc√™ decide por aqui?"
  },
  { keys:["medo","receio","inseguro","inseguran√ßa","n√£o confio","desconfio","golpe"],
    a:"Just√≠ssimo. Medo de qu√™ exatamente: documenta√ß√£o, localiza√ß√£o ou experi√™ncia passada?",
    b:"Pra voc√™ ficar tranquilo: eu te mostro o b√°sico que valida tudo (mapa/registro/condi√ß√£o por escrito). O que voc√™ quer ver primeiro?",
    c:"Voc√™ prefere validar por documento agora ou por visita? Se a valida√ß√£o ficar ok, voc√™ avan√ßa?"
  },
  { keys:["contrato","cl√°usula","clausula","papelada","documento","documenta√ß√£o"],
    a:"Perfeito voc√™ olhar isso. Qual parte te preocupa mais no contrato: prazos, multas ou garantias?",
    b:"Se voc√™ me disser o ponto, eu explico de forma simples e objetiva (sem juridiqu√™s).",
    c:"Se eu deixar isso 100% claro agora, voc√™ segue com a pr√≥xima etapa ou ainda vai travar?"
  },
  { keys:["juros","taxa","financiamento","muito juros","juros alto"],
    a:"Entendo. Voc√™ prefere otimizar parcela menor ou reduzir o total pago no fim?",
    b:"A melhor forma √© escolher um equil√≠brio: prazo que n√£o te aperte e condi√ß√£o que n√£o encare√ßa. Qual faixa mensal √© segura pra voc√™?",
    c:"Se eu te mostrar o cen√°rio mais inteligente (sem te apertar), voc√™ toma decis√£o hoje?"
  },
  { keys:["apertar","n√£o cabe","n√£o d√°","pesa","pesado","parcela alta"],
    a:"Entendi. Qual valor mensal voc√™ considera tranquilo sem estresse?",
    b:"Se a gente ajustar entrada/parcela/prazo pra caber, voc√™ fica confort√°vel em avan√ßar?",
    c:"Se n√£o encaixar no seu bolso, eu te digo na hora. Mas antes: voc√™ quer que eu tente encaixar agora?"
  },
  { keys:["desconto","abaixa","baixar","melhorar valor","melhora","negociar","negocia√ß√£o"],
    a:"Posso te ajudar nisso. Voc√™ quer melhorar mais a entrada, a parcela ou o valor final?",
    b:"Geralmente d√° pra melhorar com troca: fechar mais r√°pido ou ajustar formato. O que faz mais sentido pra voc√™?",
    c:"Se eu te entregar a melhor condi√ß√£o poss√≠vel hoje, voc√™ fecha hoje? Pra eu travar isso pra voc√™."
  },
  { keys:["n√£o conhe√ßo","nunca ouvi","n√£o sei","n√£o conhe√ßo o lugar","n√£o conhe√ßo esse"],
    a:"Normal n√£o conhecer. O que te daria mais seguran√ßa agora: localiza√ß√£o no mapa ou documenta√ß√£o?",
    b:"Eu posso te mandar um resumo em 30 segundos: onde fica, como √© o acesso e qual o diferencial. Quer?",
    c:"Se eu te mostrar tudo de forma objetiva e fizer sentido, voc√™ avan√ßa ou quer s√≥ conhecer por curiosidade?"
  },
  { keys:["tempo","sem tempo","correria","ocupado","agora n√£o posso"],
    a:"Tranquilo. Voc√™ prefere que eu te mande um resumo r√°pido por mensagem ou voc√™ quer falar em outro hor√°rio?",
    b:"Pra facilitar: qual √© melhor ‚Äî hoje √† noite ou amanh√£? E voc√™ quer focar em parcela ou localiza√ß√£o?",
    c:"Se eu te mandar tudo bem objetivo e voc√™ gostar, voc√™ me d√° um ok pra eu reservar o pr√≥ximo passo?"
  },
  { keys:["esperar","vou esperar","aguardar","vou aguardar","vou juntar"],
    a:"Entendo. Voc√™ vai esperar por grana ou por condi√ß√£o melhor?",
    b:"S√≥ um ponto: quando voc√™ for voltar, pode ter mudado pre√ßo/condi√ß√£o. O que voc√™ precisa pra considerar agora?",
    c:"Se eu conseguir manter a melhor condi√ß√£o hoje, voc√™ prefere garantir agora ou correr o risco de pagar mais depois?"
  },
  { keys:["localiza√ß√£o","longe","distante","onde fica","fica onde","bairro ruim"],
    a:"Boa pergunta. O que √© ‚Äúboa localiza√ß√£o‚Äù pra voc√™: perto do centro, trabalho ou com√©rcio?",
    b:"Se eu te mostrar no mapa e explicar o acesso (tempo real), isso j√° resolve sua d√∫vida?",
    c:"Se a localiza√ß√£o te agradar e a condi√ß√£o couber, voc√™ fecha ou ainda tem outro ponto travando?"
  },
  { keys:["visita","ver pessoalmente","ir l√°","quero ver"],
    a:"Perfeito. Ver ajuda muito. Voc√™ quer agendar em qual per√≠odo: manh√£, tarde ou fim de tarde?",
    b:"Pra visita ser objetiva: voc√™ quer avaliar terreno/localiza√ß√£o ou tirar d√∫vidas de condi√ß√£o/documenta√ß√£o?",
    c:"Se voc√™ curtir na visita e a condi√ß√£o estiver ok, voc√™ j√° deixa encaminhado pra garantir?"
  },
  { keys:["investir","investimento","valorizar","valoriza√ß√£o","revender"],
    a:"Legal. Voc√™ pensa em investir pra revender ou pra construir depois?",
    b:"Valoriza√ß√£o costuma vir de 3 fatores: crescimento ao redor, acesso e procura. Qual voc√™ quer que eu comprove primeiro?",
    c:"Se eu te mostrar que o caminho de valoriza√ß√£o √© claro, voc√™ garante agora ou prefere entrar quando j√° estiver mais caro?"
  },
  { keys:["aluguel","pagar aluguel","prefiro alugar"],
    a:"Entendo. Hoje o aluguel te incomoda mais pelo valor ou por ser um gasto sem retorno?",
    b:"Se a parcela ficar parecida com o que voc√™ j√° paga, a l√≥gica muda: voc√™ prefere pagar aluguel ou construir patrim√¥nio?",
    c:"Se eu te mostrar uma condi√ß√£o que caiba e fa√ßa sentido financeiramente, voc√™ encara ou ainda quer continuar no aluguel?"
  },
  { keys:["n√£o quero compromisso","compromisso","muito tempo","muito longo"],
    a:"Faz sentido. Voc√™ prefere algo mais curto (parcela maior) ou mais confort√°vel (prazo maior)?",
    b:"A gente pode montar um caminho pra voc√™ n√£o se sentir preso: parcela que cabe e possibilidade de antecipar quando quiser.",
    c:"Se eu te mostrar um plano que te d√° controle (sem sufoco), voc√™ decide agora?"
  }
];

/* ================= ELEMENTOS ================= */
const input = document.getElementById("input");
const r1 = document.getElementById("r1");
const r2 = document.getElementById("r2");
const r3 = document.getElementById("r3");

const prodNameEl = document.getElementById("prod-name");
const prodInfoEl = document.getElementById("prod-info");
const prodCard = document.getElementById("productCard");
const prodBadge = document.getElementById("prodBadge");
const prodChip = document.getElementById("prodChip");

const objChip = document.getElementById("objChip");
const objBadge = document.getElementById("objBadge");
const responsesWrap = document.getElementById("responsesWrap");

const toast = document.getElementById("toast");
const toastText = document.getElementById("toastText");

const micDot = document.getElementById("micDot");
const micLabel = document.getElementById("micLabel");
const micBtn = document.getElementById("micBtn");

/* ================= ESTADO (mant√©m comportamento) ================= */
let lastProduct = null;       // mant√©m √∫ltimo produto se n√£o houver novo match
let lastObjection = null;     // mant√©m √∫ltima obje√ß√£o se n√£o houver novo match
let lastObjectionKey = "";    // para exibir no chip
let lastTextProcessed = "";   // debounce simples

/* ================= FX helpers ================= */
function flashUpdated(elBadge){
  elBadge.classList.add("show");
  setTimeout(()=> elBadge.classList.remove("show"), 1000);
}

function animateUpdate(elCard){
  elCard.classList.add("fxPulse","fxSlideFade","highlightBorder");
  setTimeout(()=>{
    elCard.classList.remove("fxPulse","fxSlideFade","highlightBorder");
  }, 780);
}

function showToast(msg){
  toastText.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=> toast.classList.remove("show"), 1400);
}

/* ================= CORE (mantido: match por includes) ================= */
function processText(){
  const t = (input.value || "").toLowerCase();

  // debounce leve: evita reprocessar exatamente o mesmo texto em eventos repetidos
  if(t === lastTextProcessed) return;
  lastTextProcessed = t;

  // produto
  const p = products.find(x => x.keys.some(k => t.includes(k)));
  if(p){
    if(!lastProduct || lastProduct.name !== p.name){
      // produto mudou
      prodNameEl.textContent = p.name;
      prodInfoEl.innerHTML = p.info.map(i => "<li>"+escapeHtml(i)+"</li>").join("");
      prodChip.textContent = "Ativo";
      lastProduct = p;

      flashUpdated(prodBadge);
      animateUpdate(prodCard);
    }else{
      // mesmo produto, s√≥ garante dados
      prodNameEl.textContent = lastProduct.name;
      prodInfoEl.innerHTML = lastProduct.info.map(i => "<li>"+escapeHtml(i)+"</li>").join("");
      prodChip.textContent = "Ativo";
    }
  }else{
    // sem novo match: mant√©m √∫ltimo produto ativo (regra original)
    if(lastProduct){
      prodNameEl.textContent = lastProduct.name;
      prodInfoEl.innerHTML = lastProduct.info.map(i => "<li>"+escapeHtml(i)+"</li>").join("");
      prodChip.textContent = "Ativo";
    }else{
      prodNameEl.textContent = "Produto n√£o identificado";
      prodInfoEl.innerHTML = "";
      prodChip.textContent = "‚Äî";
    }
  }

  // obje√ß√£o
  const o = objections.find(x => x.keys.some(k => t.includes(k)));
  if(o){
    // identificar qual keyword bateu, pra exibir no chip
    const hit = o.keys.find(k => t.includes(k)) || "";
    const signature = (o.a + "||" + o.b + "||" + o.c);

    if(!lastObjection || (lastObjection.signature !== signature)){
      // obje√ß√£o mudou
      r1.textContent = o.a;
      r2.textContent = o.b;
      r3.textContent = o.c;

      lastObjection = { signature };
      lastObjectionKey = hit;

      objChip.textContent = "Obje√ß√£o: " + (hit ? ("‚Äú" + hit + "‚Äù") : "detectada");
      flashUpdated(objBadge);
      animateUpdate(responsesWrap);
    }else{
      // mesma obje√ß√£o detectada, mant√©m
      objChip.textContent = "Obje√ß√£o: " + (lastObjectionKey ? ("‚Äú" + lastObjectionKey + "‚Äù") : "detectada");
    }
  }else{
    // sem novo match: mant√©m √∫ltima obje√ß√£o (regra original)
    if(lastObjection){
      objChip.textContent = "Obje√ß√£o: " + (lastObjectionKey ? ("‚Äú" + lastObjectionKey + "‚Äù") : "‚Äî");
    }else{
      objChip.textContent = "Obje√ß√£o: ‚Äî";
    }
  }
}

/* ================= A√á√ïES ================= */
function copy(id){
  const text = (document.getElementById(id).innerText || "").trim();
  if(!text || text === "‚Äî") { showToast("Nada para copiar"); return; }

  navigator.clipboard.writeText(text)
    .then(()=> showToast("Copiado ‚úÖ"))
    .catch(()=> showToast("N√£o foi poss√≠vel copiar"));
}

function clearAll(){
  input.value = "";
  lastTextProcessed = "";
  // n√£o zera produto/obje√ß√£o por regra de UX? Aqui √© a√ß√£o expl√≠cita do usu√°rio,
  // ent√£o manteremos comportamento simples: limpa e reseta visual.
  lastProduct = null;
  lastObjection = null;
  lastObjectionKey = "";

  prodNameEl.textContent = "Produto n√£o identificado";
  prodInfoEl.innerHTML = "";
  prodChip.textContent = "‚Äî";
  objChip.textContent = "Obje√ß√£o: ‚Äî";

  r1.textContent = "‚Äî";
  r2.textContent = "‚Äî";
  r3.textContent = "‚Äî";

  animateUpdate(document.getElementById("inputCard"));
}

function closeModal(){
  document.getElementById("welcome").style.display = "none";
}

/* ================= MICROFONE (manual, sem escuta infinita) ================= */
let recognition = null;
let listening = false;

function toggleListening(){
  if(listening){
    stopListening();
    return;
  }
  startListening();
}

function startListening(){
  if(!('webkitSpeechRecognition' in window)){
    alert("Seu navegador n√£o suporta reconhecimento de voz.");
    return;
  }

  recognition = new webkitSpeechRecognition();
  recognition.lang = "pt-BR";
  recognition.continuous = false;      // n√£o vira escuta infinita
  recognition.interimResults = false;

  recognition.onstart = () => {
    listening = true;
    micDot.classList.add("on");
    micLabel.textContent = "Microfone: ouvindo";
    micBtn.textContent = "‚èπÔ∏è Parar microfone";
    micBtn.classList.add("danger");
    micBtn.classList.remove("primary");
  };

  recognition.onend = () => {
    listening = false;
    micDot.classList.remove("on");
    micLabel.textContent = "Microfone: desligado";
    micBtn.textContent = "üéôÔ∏è Ouvir microfone";
    micBtn.classList.remove("danger");
    micBtn.classList.add("primary");
  };

  recognition.onerror = () => {
    // mant√©m manual e simples
    listening = false;
  };

  recognition.onresult = (e) => {
    const transcript = e.results?.[0]?.[0]?.transcript || "";
    if(transcript){
      input.value = (input.value ? (input.value + " ") : "") + transcript;
      processText();
      animateUpdate(document.getElementById("inputCard"));
    }
  };

  recognition.start();
}

function stopListening(){
  try{
    recognition && recognition.stop();
  }catch(e){}
}

/* ================= UTIL ================= */
function escapeHtml(str){
  return String(str)
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

/* ================= EVENTOS ================= */
input.addEventListener("input", () => {
  processText();
});

// Atalho: Ctrl+K = Limpar
window.addEventListener("keydown", (e) => {
  const isMac = navigator.platform.toUpperCase().includes("MAC");
  const ctrlOrCmd = isMac ? e.metaKey : e.ctrlKey;
  if(ctrlOrCmd && (e.key.toLowerCase() === "k")){
    e.preventDefault();
    clearAll();
  }
});
</script>

</body>
</html>
